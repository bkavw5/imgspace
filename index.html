<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>imgUP - Upload ·∫¢nh</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
    .uploader { border: 2px dashed #aaa; padding: 20px; text-align: center; border-radius: 10px; background: white; }
    .preview { margin-top: 15px; }
    .result { margin-top: 20px; padding: 10px; background: #fff; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    button { margin: 5px; padding: 8px 12px; cursor: pointer; border: none; border-radius: 6px; background: #4CAF50; color: white; }
    input[type="text"], input[type="file"] { margin: 5px; padding: 6px; width: 90%; }
  </style>
</head>
<body>
  <h2>Upload ·∫¢nh v·ªõi imgUP (qua Cloudflare Proxy)</h2>

  <div>
    <label>API Token:</label><br>
    <input type="text" id="token" placeholder="Nh·∫≠p Bearer token" value="premium-token-789">
  </div>

  <div>
    <label><input type="checkbox" id="preserve"> Gi·ªØ nguy√™n ƒë·ªãnh d·∫°ng g·ªëc</label>
  </div>

  <div class="uploader" id="dropzone">
    <p>K√©o & th·∫£ ·∫£nh v√†o ƒë√¢y ho·∫∑c ch·ªçn file</p>
    <input type="file" id="fileInput" multiple accept="image/*">
    <br>
    <button onclick="uploadFiles()">Upload</button>
  </div>

  <div id="preview" class="preview"></div>
  <div id="results"></div>

<script>
  const API_PROXY = "https://imgspace.abuadun4.workers.dev/"; // üî• thay b·∫±ng link Worker c·ªßa b·∫°n

  let selectedFiles = [];

  document.getElementById("fileInput").addEventListener("change", e => {
    selectedFiles = Array.from(e.target.files);
    renderPreview();
  });

  function renderPreview() {
    const preview = document.getElementById("preview");
    preview.innerHTML = "";
    selectedFiles.forEach(file => {
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      img.style.maxWidth = "150px";
      img.style.margin = "5px";
      preview.appendChild(img);
    });
  }

  async function uploadFiles() {
    if (selectedFiles.length === 0) {
      alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt ·∫£nh!");
      return;
    }

    const token = document.getElementById("token").value.trim();
    const preserve = document.getElementById("preserve").checked ? "1" : "0";

    const fd = new FormData();
    selectedFiles.forEach(file => fd.append("files", file));
    fd.append("preserveFormat", preserve);

    try {
      const res = await fetch(API_PROXY, {
        method: "POST",
        headers: { "Authorization": "Bearer " + token },
        body: fd
      });

      const data = await res.json();
      showResults(data);
    } catch (err) {
      alert("L·ªói: " + err.message);
    }
  }

  function showResults(data) {
    const box = document.getElementById("results");
    box.innerHTML = "<h3>K·∫øt qu·∫£:</h3>";

    if (!data.results) {
      box.innerHTML += "<p style='color:red'>Upload th·∫•t b·∫°i</p>";
      return;
    }

    data.results.forEach(r => {
      const div = document.createElement("div");
      div.className = "result";
      div.innerHTML = `
        <p><b>${r.filename}</b> (${r.size} KB)</p>
        <img src="${r.url}" style="max-width:200px"><br>
        <input type="text" value="${r.url}" readonly>
        <button onclick="navigator.clipboard.writeText('${r.url}')">Copy Link</button>
        <a href="${r.url}" target="_blank"><button>M·ªü</button></a>
      `;
      box.appendChild(div);
    });
  }
</script>
</body>
</html>

